go test -v -tags=e2e ./tests/e2e/...
2026/01/05 09:40:53 === Building Talos snapshots for E2E tests ===
2026/01/05 09:40:53 Building amd64 snapshot...
2026/01/05 09:40:53 Generating SSH key key-build-talos-v1.8.3-k8s-v1.31.0-amd64-20260105094053...
2026/01/05 09:40:53 Creating server build-talos-v1.8.3-k8s-v1.31.0-amd64-20260105094053...
2026/01/05 09:41:10 Server IP: 95.217.21.45
2026/01/05 09:41:10 Enabling Rescue Mode...
2026/01/05 09:41:28 Resetting server to boot into Rescue Mode...
2026/01/05 09:41:49 Waiting for Rescue System...
2026/01/05 09:41:59 Provisioning Talos (Command: DISK=$(lsblk -d -n -o NAME | grep -E '^sda|^vda' | head -n 1) && if [ -z "$DISK" ]; then echo 'No disk found'; exit 1; fi && echo "Writing to /dev/$DISK" && apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y zstd wget && wget -qO- https://github.com/siderolabs/talos/releases/download/v1.8.3/metal-amd64.raw.zst | zstd -d | dd of=/dev/$DISK bs=4M && sync)...
2026/01/05 09:42:35 Powering off server for snapshot...
2026/01/05 09:42:46 Creating snapshot...
2026/01/05 09:43:51 Cleaning up server build-talos-v1.8.3-k8s-v1.31.0-amd64-20260105094053...
2026/01/05 09:43:51 Server build-talos-v1.8.3-k8s-v1.31.0-amd64-20260105094053 deleted successfully
2026/01/05 09:43:51 Cleaning up SSH key key-build-talos-v1.8.3-k8s-v1.31.0-amd64-20260105094053...
2026/01/05 09:43:51 SSH key key-build-talos-v1.8.3-k8s-v1.31.0-amd64-20260105094053 deleted successfully
2026/01/05 09:43:51 Built amd64 snapshot: 346899525
2026/01/05 09:43:51 Building arm64 snapshot...
2026/01/05 09:43:51 Generating SSH key key-build-talos-v1.8.3-k8s-v1.31.0-arm64-20260105094351...
2026/01/05 09:43:51 Creating server build-talos-v1.8.3-k8s-v1.31.0-arm64-20260105094351...
2026/01/05 09:44:03 Server IP: 37.27.196.42
2026/01/05 09:44:03 Enabling Rescue Mode...
2026/01/05 09:44:13 Resetting server to boot into Rescue Mode...
2026/01/05 09:44:26 Waiting for Rescue System...
2026/01/05 09:44:36 Provisioning Talos (Command: DISK=$(lsblk -d -n -o NAME | grep -E '^sda|^vda' | head -n 1) && if [ -z "$DISK" ]; then echo 'No disk found'; exit 1; fi && echo "Writing to /dev/$DISK" && apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y zstd wget && wget -qO- https://github.com/siderolabs/talos/releases/download/v1.8.3/metal-arm64.raw.zst | zstd -d | dd of=/dev/$DISK bs=4M && sync)...
2026/01/05 09:45:15 Powering off server for snapshot...
2026/01/05 09:45:23 Creating snapshot...
2026/01/05 09:46:15 Cleaning up server build-talos-v1.8.3-k8s-v1.31.0-arm64-20260105094351...
2026/01/05 09:46:15 Server build-talos-v1.8.3-k8s-v1.31.0-arm64-20260105094351 deleted successfully
2026/01/05 09:46:15 Cleaning up SSH key key-build-talos-v1.8.3-k8s-v1.31.0-arm64-20260105094351...
2026/01/05 09:46:15 SSH key key-build-talos-v1.8.3-k8s-v1.31.0-arm64-20260105094351 deleted successfully
2026/01/05 09:46:15 Built arm64 snapshot: 346899532
=== RUN   TestClusterProvisioning
    cluster_test.go:73: Using shared Talos snapshot from test suite
    helpers.go:37: Generating SSH key e2e-test-1767602775-key-1767602775741165000...
2026/01/05 09:46:16 Starting reconciliation...
2026/01/05 09:46:16 Reconciling Network e2e-test-1767602775...
2026/01/05 09:46:16 Reconciling Firewall e2e-test-1767602775...
2026/01/05 09:46:16 Reconciling Load Balancer e2e-test-1767602775-kube-api...
2026/01/05 09:46:34 Reconciling Control Plane...
2026/01/05 09:46:34 Setting Talos Endpoint to: https://95.217.171.26:6443
2026/01/05 09:46:34 Creating control-plane Server e2e-test-1767602775-control-plane-1...
2026/01/05 09:46:34 Found existing Talos snapshot: talos-v1.8.3-k8s-v1.31.0-amd64 (ID: 346899525)
2026/01/05 09:46:34 Using Talos image: 346899525
2026/01/05 09:49:14 Bootstrapping cluster e2e-test-1767602775 with 1 control plane nodes...
2026/01/05 09:49:14 Applying machine configurations to control plane nodes...
2026/01/05 09:49:14 Applying config to node e2e-test-1767602775-control-plane-1 (37.27.196.42)...
    cluster_test.go:134: 
        	Error Trace:	/Users/milan.kappen/Repos/Private/hcloud-kubernetes/tests/e2e/cluster_test.go:134
        	Error:      	Received unexpected error:
        	            	failed to bootstrap cluster: failed to apply config to node e2e-test-1767602775-control-plane-1: failed to apply configuration: rpc error: code = InvalidArgument desc = configuration validation failed: 2 errors occurred:
        	            		* an install disk is required in "metal" mode
        	            		* specified install disk does not exist: ""
        	            	
        	Test:       	TestClusterProvisioning
    cluster_test.go:148: Verifying APIs: Talos=37.27.196.42:50000, Kube=95.217.171.26:6443
    cluster_test.go:154: Talos API is reachable!
    cluster_test.go:161: Kube API is reachable!
[Cleanup] Deleted Servers
[Cleanup] Deleted LB
[Cleanup] Deleted FW
[Cleanup] Deleted Network
[Cleanup] Deleted PGs
[Cleanup] Deleted Certificates
    helpers.go:50: Deleting SSH key e2e-test-1767602775-key-1767602775741165000...
--- FAIL: TestClusterProvisioning (202.28s)
=== RUN   TestInfraProvisioning
    helpers.go:37: Generating SSH key e2e-1767602978-key-1767602978018214000...
    infra_test.go:98: Running Reconcile for e2e-1767602978...
2026/01/05 09:49:38 Starting reconciliation...
2026/01/05 09:49:38 Reconciling Network e2e-1767602978...
2026/01/05 09:49:38 Reconciling Firewall e2e-1767602978...
2026/01/05 09:49:38 Reconciling Load Balancer e2e-1767602978-kube-api...
2026/01/05 09:49:53 Reconciling Control Plane...
2026/01/05 09:49:53 Setting Talos Endpoint to: https://65.109.41.54:6443
2026/01/05 09:49:53 Creating control-plane Server e2e-1767602978-control-plane-1-1...
2026/01/05 09:49:54 Found existing Talos snapshot: talos-v1.8.3-k8s-v1.31.0-amd64 (ID: 346899525)
2026/01/05 09:49:54 Using Talos image: 346899525
    infra_test.go:101: Reconcile returned error: failed to reconcile control plane: failed to create server e2e-1767602978-control-plane-1-1: failed to wait for server creation: Get "https://api.hetzner.cloud/v1/actions?id=603288292861034&page=1&sort=status&sort=id": read tcp [2a02:8071:78d3:bb20:ac58:a5f5:393:d2de]:58119->[2a01:4f8:0:1::4:73]:443: read: connection reset by peer
    infra_test.go:105: Verifying resources...
    infra_test.go:146: LB Private IP: 10.0.64.254
    infra_test.go:148: Infra provisioning verified successfully.
    infra_test.go:84: Cleaning up resources for e2e-1767602978...
    infra_test.go:94: Deleted Resources
    helpers.go:50: Deleting SSH key e2e-1767602978-key-1767602978018214000...
--- PASS: TestInfraProvisioning (74.89s)
=== RUN   TestImageBuildLifecycle
=== RUN   TestImageBuildLifecycle/amd64
    main_test.go:73: Using shared amd64 snapshot: 346899525
    main_test.go:121: Creating verification server verify-amd64-20260105-100759...
    helpers.go:37: Generating SSH key verify-amd64-20260105-100759-key-1767604079517367000...
    main_test.go:148: Verification server IP: 95.217.21.45
    main_test.go:151: Waiting for Talos API (port 50000) on 95.217.21.45...
    main_test.go:172: Successfully performed TLS handshake with Talos API on 95.217.21.45:50000
    helpers.go:50: Deleting SSH key verify-amd64-20260105-100759-key-1767604079517367000...
    main_test.go:114: Deleting verification server verify-amd64-20260105-100759...
=== RUN   TestImageBuildLifecycle/arm64
    main_test.go:76: Using shared arm64 snapshot: 346899532
    main_test.go:121: Creating verification server verify-arm64-20260105-105916...
    helpers.go:37: Generating SSH key verify-arm64-20260105-105916-key-1767607156927844000...
    main_test.go:141: Failed to create verification server: failed to wait for server creation: Get "https://api.hetzner.cloud/v1/actions?id=603296882814392&page=1&sort=status&sort=id": read tcp [2a02:8071:78d3:bb20:35f6:fd20:bcd2:b2a2]:58631->[2a01:4f8:0:1::4:73]:443: read: connection reset by peer
    helpers.go:50: Deleting SSH key verify-arm64-20260105-105916-key-1767607156927844000...
    main_test.go:114: Deleting verification server verify-arm64-20260105-105916...
--- FAIL: TestImageBuildLifecycle (18.40s)
    --- PASS: TestImageBuildLifecycle/amd64 (13.28s)
    --- FAIL: TestImageBuildLifecycle/arm64 (5.12s)
FAIL
2026/01/05 11:12:41 === Cleaning up shared snapshots ===
2026/01/05 11:12:41 Deleting amd64 snapshot 346899525...
2026/01/05 11:12:41 Deleting arm64 snapshot 346899532...
FAIL	github.com/sak-d/hcloud-k8s/tests/e2e	619.616s
FAIL
make: *** [e2e] Error 1
