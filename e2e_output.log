=== RUN   TestClusterProvisioning
    helpers.go:37: Generating SSH key e2e-test-1767485299-key-1767485299102924942...
2026/01/04 00:08:19 Starting reconciliation...
2026/01/04 00:08:19 Reconciling Network e2e-test-1767485299...
2026/01/04 00:08:20 Reconciling Firewall e2e-test-1767485299...
2026/01/04 00:08:20 Reconciling Load Balancer e2e-test-1767485299-kube-api...
2026/01/04 00:08:37 Reconciling Control Plane...
2026/01/04 00:08:37 Setting Talos Endpoint to: https://65.109.41.54:6443
2026/01/04 00:08:38 Creating control-plane Server e2e-test-1767485299-control-plane-1...
2026/01/04 00:08:51 Bootstrapping cluster e2e-test-1767485299...
    cluster_test.go:122: Reconcile returned error (expected as we can't bootstrap debian): failed to bootstrap cluster: failed to parse client config: yaml: unmarshal errors:
          line 1: cannot unmarshal !!str `mock-cl...` into config.Config
[Cleanup] Deleted Servers
[Cleanup] Deleted LB
[Cleanup] Deleted FW
[Cleanup] Deleted Network
    helpers.go:50: Deleting SSH key e2e-test-1767485299-key-1767485299102924942...
--- PASS: TestClusterProvisioning (35.07s)
=== RUN   TestInfraProvisioning
    helpers.go:37: Generating SSH key e2e-1767485334-key-1767485334173327498...
    infra_test.go:96: Running Reconcile for e2e-1767485334...
2026/01/04 00:08:54 Starting reconciliation...
2026/01/04 00:08:54 Reconciling Network e2e-1767485334...
2026/01/04 00:08:55 Reconciling Firewall e2e-1767485334...
2026/01/04 00:08:55 Reconciling Load Balancer e2e-1767485334-kube-api...
2026/01/04 00:09:13 Reconciling Control Plane...
2026/01/04 00:09:13 Setting Talos Endpoint to: https://65.109.41.54:6443
2026/01/04 00:09:13 Creating control-plane Server e2e-1767485334-control-plane-1-1...
2026/01/04 00:09:27 Bootstrapping cluster e2e-1767485334...
    infra_test.go:101: Reconcile returned error (expected in mock/partial E2E): failed to bootstrap cluster: failed to parse client config: yaml: unmarshal errors:
          line 1: cannot unmarshal !!str `mock-cl...` into config.Config
    infra_test.go:105: Verifying resources...
    infra_test.go:146: LB Private IP: 10.0.64.254
    infra_test.go:148: Infra provisioning verified successfully.
    infra_test.go:84: Cleaning up resources for e2e-1767485334...
    helpers.go:50: Deleting SSH key e2e-1767485334-key-1767485334173327498...
--- PASS: TestInfraProvisioning (36.79s)
=== RUN   TestImageBuildLifecycle
=== RUN   TestImageBuildLifecycle/amd64
=== PAUSE TestImageBuildLifecycle/amd64
=== RUN   TestImageBuildLifecycle/arm64
=== PAUSE TestImageBuildLifecycle/arm64
=== CONT  TestImageBuildLifecycle/amd64
=== CONT  TestImageBuildLifecycle/arm64
=== NAME  TestImageBuildLifecycle/amd64
    main_test.go:78: Starting build for amd64...
=== NAME  TestImageBuildLifecycle/arm64
2026/01/04 00:09:30 Generating SSH key key-build-e2e-test-image-amd64-20260104-000930-20260104000930...
    main_test.go:78: Starting build for arm64...
2026/01/04 00:09:30 Generating SSH key key-build-e2e-test-image-arm64-20260104-000930-20260104000930...
2026/01/04 00:09:31 Creating server build-e2e-test-image-amd64-20260104-000930-20260104000930...
2026/01/04 00:09:31 Creating server build-e2e-test-image-arm64-20260104-000930-20260104000930...
2026/01/04 00:09:44 Server IP: 77.42.32.80
2026/01/04 00:09:44 Enabling Rescue Mode...
2026/01/04 00:09:51 Server IP: 37.27.196.42
2026/01/04 00:09:51 Enabling Rescue Mode...
2026/01/04 00:09:54 Resetting server to boot into Rescue Mode...
2026/01/04 00:10:10 Waiting for Rescue System...
2026/01/04 00:10:12 Resetting server to boot into Rescue Mode...
2026/01/04 00:10:20 Provisioning Talos (Command: DISK=$(lsblk -d -n -o NAME | grep -E '^sda|^vda' | head -n 1) && if [ -z "$DISK" ]; then echo 'No disk found'; exit 1; fi && echo "Writing to /dev/$DISK" && apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y zstd wget && wget -qO- https://github.com/siderolabs/talos/releases/download/v1.12.0/metal-arm64.raw.zst | zstd -d | dd of=/dev/$DISK bs=4M && sync)...
2026/01/04 00:10:36 Waiting for Rescue System...
2026/01/04 00:10:46 Provisioning Talos (Command: DISK=$(lsblk -d -n -o NAME | grep -E '^sda|^vda' | head -n 1) && if [ -z "$DISK" ]; then echo 'No disk found'; exit 1; fi && echo "Writing to /dev/$DISK" && apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y zstd wget && wget -qO- https://github.com/siderolabs/talos/releases/download/v1.12.0/metal-amd64.raw.zst | zstd -d | dd of=/dev/$DISK bs=4M && sync)...
2026/01/04 00:10:55 Powering off server for snapshot...
2026/01/04 00:11:04 Creating snapshot...
2026/01/04 00:11:28 Powering off server for snapshot...
2026/01/04 00:11:40 Creating snapshot...
2026/01/04 00:12:00 Cleaning up server build-e2e-test-image-arm64-20260104-000930-20260104000930...
2026/01/04 00:12:00 Server build-e2e-test-image-arm64-20260104-000930-20260104000930 deleted successfully
2026/01/04 00:12:00 Deleting SSH key key-build-e2e-test-image-arm64-20260104-000930-20260104000930...
    main_test.go:97: Build successful for arm64, snapshot ID: 346532892
    main_test.go:111: Creating verification server verify-arm64-20260104-001200...
    helpers.go:37: Generating SSH key verify-arm64-20260104-001200-key-1767485520642996613...
2026/01/04 00:12:42 Cleaning up server build-e2e-test-image-amd64-20260104-000930-20260104000930...
2026/01/04 00:12:42 Server build-e2e-test-image-amd64-20260104-000930-20260104000930 deleted successfully
2026/01/04 00:12:42 Deleting SSH key key-build-e2e-test-image-amd64-20260104-000930-20260104000930...
=== NAME  TestImageBuildLifecycle/amd64
    main_test.go:97: Build successful for amd64, snapshot ID: 346532894
    main_test.go:111: Creating verification server verify-amd64-20260104-001242...
    helpers.go:37: Generating SSH key verify-amd64-20260104-001242-key-1767485562616726066...
=== NAME  TestImageBuildLifecycle/arm64
    main_test.go:138: Verification server IP: 95.217.191.156
    main_test.go:141: Waiting for Talos API (port 50000) on 95.217.191.156...
=== NAME  TestImageBuildLifecycle/amd64
    main_test.go:138: Verification server IP: 77.42.32.80
    main_test.go:141: Waiting for Talos API (port 50000) on 77.42.32.80...
=== NAME  TestImageBuildLifecycle/arm64
    main_test.go:167: Waiting for Talos API... last error: dial tcp 95.217.191.156:50000: i/o timeout
=== NAME  TestImageBuildLifecycle/amd64
    main_test.go:167: Waiting for Talos API... last error: dial tcp 77.42.32.80:50000: i/o timeout
=== NAME  TestImageBuildLifecycle/arm64
    main_test.go:167: Waiting for Talos API... last error: dial tcp 95.217.191.156:50000: connect: connection refused
    main_test.go:162: Successfully performed TLS handshake with Talos API on 95.217.191.156:50000
    helpers.go:50: Deleting SSH key verify-arm64-20260104-001200-key-1767485520642996613...
    main_test.go:104: Deleting verification server verify-arm64-20260104-001200...
    main_test.go:87: Deleting snapshot 346532892...
=== NAME  TestImageBuildLifecycle/amd64
    main_test.go:167: Waiting for Talos API... last error: dial tcp 77.42.32.80:50000: i/o timeout
    main_test.go:162: Successfully performed TLS handshake with Talos API on 77.42.32.80:50000
    helpers.go:50: Deleting SSH key verify-amd64-20260104-001242-key-1767485562616726066...
    main_test.go:104: Deleting verification server verify-amd64-20260104-001242...
    main_test.go:87: Deleting snapshot 346532894...
--- PASS: TestImageBuildLifecycle (0.00s)
    --- PASS: TestImageBuildLifecycle/arm64 (266.82s)
    --- PASS: TestImageBuildLifecycle/amd64 (275.83s)
PASS
ok  	github.com/sak-d/hcloud-k8s/tests/e2e	347.711s
