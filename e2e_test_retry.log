=== RUN   TestImageBuildLifecycle
=== RUN   TestImageBuildLifecycle/amd64
    main_test.go:95: Starting build for amd64...
2026/01/02 09:49:33 Generating SSH key key-build-e2e-test-image-amd64-20260102-094933-20260102094933...
2026/01/02 09:49:35 Creating server build-e2e-test-image-amd64-20260102-094933-20260102094933...
2026/01/02 09:49:49 Server IP: 77.42.32.80
2026/01/02 09:49:49 Enabling Rescue Mode...
2026/01/02 09:49:58 Resetting server to boot into Rescue Mode...
2026/01/02 09:50:12 Waiting for Rescue System...
2026/01/02 09:50:22 Provisioning Talos (Command: DISK=$(lsblk -d -n -o NAME | grep -E '^sda|^vda' | head -n 1) && if [ -z "$DISK" ]; then echo 'No disk found'; exit 1; fi && echo "Writing to /dev/$DISK" && apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y zstd && wget -O /tmp/talos.raw.zst https://github.com/siderolabs/talos/releases/download/v1.12.0/metal-amd64.raw.zst && zstd -d -c /tmp/talos.raw.zst | dd of=/dev/$DISK bs=4M && sync)...
2026/01/02 09:50:58 Powering off server for snapshot...
2026/01/02 09:51:06 Creating snapshot...
2026/01/02 09:51:59 Cleaning up server build-e2e-test-image-amd64-20260102-094933-20260102094933...
2026/01/02 09:51:59 Server build-e2e-test-image-amd64-20260102-094933-20260102094933 deleted successfully
2026/01/02 09:51:59 Deleting SSH key key-build-e2e-test-image-amd64-20260102-094933-20260102094933...
    main_test.go:114: Build successful for amd64, snapshot ID: 346076034
    main_test.go:128: Creating verification server verify-amd64-20260102-095159...
    main_test.go:173: Verification server IP: 95.217.191.156
    main_test.go:176: Waiting for Talos API (port 50000) on 95.217.191.156...
    main_test.go:202: Waiting for Talos API... last error: dial tcp 95.217.191.156:50000: i/o timeout
    main_test.go:202: Waiting for Talos API... last error: dial tcp 95.217.191.156:50000: connect: connection refused
    main_test.go:197: Successfully performed TLS handshake with Talos API on 95.217.191.156:50000
    main_test.go:147: Deleting SSH key key-verify-amd64-20260102-095159...
    main_test.go:121: Deleting verification server verify-amd64-20260102-095159...
    main_test.go:104: Deleting snapshot 346076034...
=== RUN   TestImageBuildLifecycle/arm64
    main_test.go:95: Starting build for arm64...
2026/01/02 09:53:25 Generating SSH key key-build-e2e-test-image-arm64-20260102-095325-20260102095325...
2026/01/02 09:53:25 Creating server build-e2e-test-image-arm64-20260102-095325-20260102095325...
2026/01/02 09:53:37 Server IP: 77.42.32.80
2026/01/02 09:53:37 Enabling Rescue Mode...
2026/01/02 09:53:46 Resetting server to boot into Rescue Mode...
2026/01/02 09:53:59 Waiting for Rescue System...
2026/01/02 09:54:09 Provisioning Talos (Command: DISK=$(lsblk -d -n -o NAME | grep -E '^sda|^vda' | head -n 1) && if [ -z "$DISK" ]; then echo 'No disk found'; exit 1; fi && echo "Writing to /dev/$DISK" && apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y zstd && wget -O /tmp/talos.raw.zst https://github.com/siderolabs/talos/releases/download/v1.12.0/metal-arm64.raw.zst && zstd -d -c /tmp/talos.raw.zst | dd of=/dev/$DISK bs=4M && sync)...
2026/01/02 09:54:45 Powering off server for snapshot...
2026/01/02 09:54:52 Creating snapshot...
2026/01/02 09:55:46 Cleaning up server build-e2e-test-image-arm64-20260102-095325-20260102095325...
2026/01/02 09:55:46 Server build-e2e-test-image-arm64-20260102-095325-20260102095325 deleted successfully
2026/01/02 09:55:46 Deleting SSH key key-build-e2e-test-image-arm64-20260102-095325-20260102095325...
    main_test.go:114: Build successful for arm64, snapshot ID: 346076045
    main_test.go:128: Creating verification server verify-arm64-20260102-095546...
    main_test.go:173: Verification server IP: 95.217.191.156
    main_test.go:176: Waiting for Talos API (port 50000) on 95.217.191.156...
    main_test.go:202: Waiting for Talos API... last error: dial tcp 95.217.191.156:50000: i/o timeout
    main_test.go:202: Waiting for Talos API... last error: dial tcp 95.217.191.156:50000: connect: connection refused
    main_test.go:197: Successfully performed TLS handshake with Talos API on 95.217.191.156:50000
    main_test.go:147: Deleting SSH key key-verify-arm64-20260102-095546...
    main_test.go:121: Deleting verification server verify-arm64-20260102-095546...
    main_test.go:104: Deleting snapshot 346076045...
--- PASS: TestImageBuildLifecycle (476.50s)
    --- PASS: TestImageBuildLifecycle/amd64 (231.17s)
    --- PASS: TestImageBuildLifecycle/arm64 (245.33s)
PASS
ok  	github.com/sak-d/hcloud-k8s/tests/e2e	476.526s
